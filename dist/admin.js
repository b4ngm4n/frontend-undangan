(()=>{var T=(()=>{let o=r=>String(r).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),m=(r,f)=>{let h=null;h=setTimeout(()=>{r(),clearTimeout(h),h=null},f)};return{copy:async(r,f=null,h=1500)=>{let B=r.getAttribute("data-copy");if(!B||B.length==0){alert("Nothing to copy");return}r.disabled=!0;try{await navigator.clipboard.writeText(B)}catch{r.disabled=!1,alert("Failed to copy");return}let u=r.innerHTML;r.innerHTML=f||'<i class="fa-solid fa-check"></i>',m(()=>{r.disabled=!1,r.innerHTML=u},h)},timeOut:m,escapeHtml:o,base64Encode:r=>{let h=new TextEncoder().encode(r);return window.btoa(String.fromCharCode(...h))},base64Decode:r=>{let f=new TextDecoder,h=Uint8Array.from(window.atob(r),B=>B.charCodeAt(0));return f.decode(h)},disableButton:(r,f="Loading")=>{r.disabled=!0;let h=r.innerHTML;return r.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${f}`,{restore:()=>{r.innerHTML=h,r.disabled=!1}}},disableCheckbox:r=>{r.disabled=!0;let f=document.querySelector(`label[for="${r.id}"]`),h=f.innerHTML;return f.innerHTML=`<span class="spinner-border spinner-border-sm my-0 ms-0 me-1 p-0" style="height: 0.8rem; width: 0.8rem"></span>${h}`,{restore:()=>{f.innerHTML=h,r.disabled=!1}}},parseUserAgent:r=>{let f=[{type:"Mobile",regex:/Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i},{type:"Tablet",regex:/iPad|Android(?!.*Mobile)/i},{type:"Desktop",regex:/Windows NT|Macintosh|Linux/i}],h=[{name:"Chrome",regex:/Chrome|CriOS/i},{name:"Safari",regex:/Safari/i},{name:"Edge",regex:/Edg|Edge/i},{name:"Firefox",regex:/Firefox|FxiOS/i},{name:"Opera",regex:/Opera|OPR/i},{name:"Internet Explorer",regex:/MSIE|Trident/i}],B=[{name:"Windows",regex:/Windows NT ([\d.]+)/i},{name:"MacOS",regex:/Mac OS X ([\d_]+)/i},{name:"Android",regex:/Android ([\d.]+)/i},{name:"iOS",regex:/OS ([\d_]+) like Mac OS X/i},{name:"Linux",regex:/Linux/i}],u=f.find($=>$.regex.test(r))?.type||"Unknown",k=h.find($=>$.regex.test(r))?.name||"Unknown",n=B.find($=>$.regex.test(r)),p=n&&r.match(n.regex)?.[1]?.replace(/_/g,".")||"",v=n?n.name:"Unknown";return p=p?`${v} ${p}`:v,`${k} ${u} ${p}`}}})();var F={tab:g=>window.bootstrap.Tab.getOrCreateInstance(document.getElementById(g)),modal:g=>window.bootstrap.Modal.getOrCreateInstance(document.getElementById(g))};var I=(()=>{let o=(u,k,n)=>({code:u,data:k,error:n}),m=(u=0)=>({love:u}),g=({uuid:u,own:k,name:n,presence:p,comment:v,created_at:$,is_admin:H,ip:s,user_agent:t,comments:w,like:e})=>({uuid:u,own:k,name:n,presence:p,comment:v,created_at:$,is_admin:H??!1,ip:s,user_agent:t,comments:w?.map(g)??[],like:m(e?.love??0)});return{uuidResponse:({uuid:u})=>({uuid:u}),baseResponse:o,tokenResponse:({token:u})=>({token:u}),statusResponse:({status:u})=>({status:u}),commentResponse:({name:u,presence:k,comment:n,is_admin:p,created_at:v})=>({name:u,presence:k,comment:n,is_admin:p,created_at:v}),likeCommentResponse:m,getCommentResponse:g,getCommentsResponse:u=>u.map(g),commentShowMore:(u,k=!1)=>({uuid:u,show:k}),postCommentRequest:(u,k,n,p)=>({id:u,name:k,presence:n,comment:p}),postSessionRequest:(u,k)=>({email:u,password:k}),updateCommentRequest:(u,k)=>({presence:u,comment:k})}})();var L=o=>{let m=(l=null)=>{let y=JSON.parse(localStorage.getItem(o));return l?y[String(l)]:y},g=(l,y)=>{let r=m();r[String(l)]=y,localStorage.setItem(o,JSON.stringify(r))},d=l=>Object.keys(m()).includes(String(l)),i=l=>{if(!d(l))return;let y=m();delete y[String(l)],localStorage.setItem(o,JSON.stringify(y))},c=()=>localStorage.setItem(o,"{}");return localStorage.getItem(o)||c(),{set:g,get:m,has:d,clear:c,unset:i}};var O="GET",G="PUT",U="POST",D="PATCH",W="DELETE",A=(o,m)=>{let g=document.body.getAttribute("data-url"),d={method:String(o).toUpperCase(),headers:new Headers({Accept:"application/json","Content-Type":"application/json"})};return g.slice(-1)==="/"&&(g=g.slice(0,-1)),{send(i=null){return fetch(g+m,d).then(c=>c.json().then(l=>{if(c.status>=500&&(l.message??l[0]))throw new Error(l.message??l[0]);if(l.error)throw new Error(l.error[0]);return i&&(l.data=i(l.data)),I.baseResponse(l.code,l.data,l.error)})).catch(c=>{throw alert(c),new Error(c)})},download(){return fetch(g+m,d).then(i=>{if(i.status!==200)return!1;let c=document.querySelector("a[download]");c&&document.body.removeChild(c);let l=i.headers.get("content-disposition")?.match(/filename="(.+)"/)?.[1]??"download.csv";return i.blob().then(y=>{let r=document.createElement("a"),f=window.URL.createObjectURL(y);return r.href=f,r.download=l,document.body.appendChild(r),r.click(),document.body.removeChild(r),window.URL.revokeObjectURL(f),!0})}).catch(i=>{throw alert(i),new Error(i)})},token(i){return i.split(".").length===3?(d.headers.append("Authorization","Bearer "+i),this):(d.headers.append("x-access-key",i),this)},body(i){return d.body=JSON.stringify(i),this}}};var x=(()=>{let o=null,m=()=>o.get("token"),g=f=>A(U,"/api/session").body(f).send(I.tokenResponse).then(h=>(h.code===200&&i(h.data.token),h.code===200),()=>!1),d=()=>o.unset("token"),i=f=>o.set("token",f),c=()=>String(m()??".").split(".").length===3;return{init:()=>{o=L("session")},guest:()=>A(O,"/api/config").token(m()).send().then(f=>{if(f.code!==200)return f;let h=L("config");for(let[B,u]of Object.entries(f.data))h.set(B,u);return f}),login:g,logout:d,decode:()=>{if(!c())return null;try{return JSON.parse(window.atob(m().split(".")[1]))}catch{return null}},isAdmin:c,setToken:i,getToken:m}})();var j=(()=>{let o=null,m=async l=>{let y=T.disableButton(l),r=document.getElementById("loginEmail"),f=document.getElementById("loginPassword");r.disabled=!0,f.disabled=!0,await x.login(I.postSessionRequest(r.value,f.value))&&(r.value=null,f.value=null,F.modal("mainModal").hide()),y.restore(),r.disabled=!1,f.disabled=!1},g=()=>A(O,"/api/user").token(x.getToken()).send().then(l=>{if(l.code!==200)return l;for(let[y,r]of Object.entries(l.data))o.set(y,r);return l},l=>(i(),l)),d=()=>o,i=()=>{o.clear(),x.logout(),F.modal("mainModal").show()};return{init:()=>{o=L("user")},login:m,clearSession:i,getDetailUser:g,getUserStorage:d}})();var K=(()=>{let o=(d,i)=>{F.tab(i).show(),d.classList.add("active"),document.querySelectorAll(".navbar button").forEach(c=>{c.classList.contains("active")&&c.classList.remove("active")})};return{buttonNavHome:d=>{o(d,"button-home")},buttonNavSetting:d=>{o(d,"button-setting")}}})();var J=(()=>{let o={"#000000":"#ffffff","#ffffff":"#000000","#212529":"#f8f9fa","#f8f9fa":"#212529"},m=["#ffffff","#f8f9fa"],g=["#000000","#212529"],d=!1,i=null,c=null,l=()=>i.set("active","light"),y=()=>i.set("active","dark"),r=v=>{let $=c.getAttribute("content");c.setAttribute("content",v.some(H=>H===$)?o[$]:$)},f=()=>{l(),document.documentElement.setAttribute("data-bs-theme","light"),r(g)},h=()=>{y(),document.documentElement.setAttribute("data-bs-theme","dark"),r(m)},B=(v=null,$=null)=>{let H=i.get("active")==="dark";return v&&$?H?v:$:H};return{init:()=>{switch(i=L("theme"),c=document.querySelector('meta[name="theme-color"]'),i.has("active")||(window.matchMedia("(prefers-color-scheme: dark)").matches?y():l()),document.documentElement.getAttribute("data-bs-theme")){case"dark":y();break;case"light":l();break;default:d=!0}B()?h():f()},spyTop:()=>{let v=H=>{H.filter(s=>s.isIntersecting).forEach(s=>{let t=s.target.classList.contains("bg-white-black")?B(g[0],m[0]):B(g[1],m[1]);c.setAttribute("content",t)})},$=new IntersectionObserver(v,{rootMargin:"0% 0% -95% 0%"});document.querySelectorAll("section").forEach(H=>$.observe(H))},change:()=>B()?f():h(),isDarkMode:B,isAutoMode:()=>d}})();var X=(()=>{let o=null,m=!0,g=u=>new Promise(k=>{let n=parseFloat(o.style.opacity),p=null,v=u?.05:-.05,$=u?1:0;p=setInterval(()=>{n=Math.max(0,Math.min(1,n+v)),o.style.opacity=n.toFixed(2),n===$&&(k(),clearInterval(p),p=null)},10)}),d=()=>{let u=null;u=setTimeout(()=>{clearTimeout(u),u=null,m&&l()},3e3)},i=()=>{let u=o.firstElementChild.firstElementChild;u.classList.remove("bg-success"),u.classList.add("bg-danger"),u.firstElementChild.innerHTML='<i class="fa-solid fa-ban me-2"></i>Koneksi tidak tersedia'},c=()=>{let u=o.firstElementChild.firstElementChild;u.classList.remove("bg-danger"),u.classList.add("bg-success"),u.firstElementChild.innerHTML='<i class="fa-solid fa-cloud me-2"></i>Koneksi tersedia kembali'},l=async()=>{await g(!1),i()},y=()=>{let u=["input[data-offline-disabled]","button[data-offline-disabled]","select[data-offline-disabled]","textarea[data-offline-disabled]"].join(", ");document.querySelectorAll(u).forEach(k=>{k.dispatchEvent(new Event(h()?"online":"offline")),k.setAttribute("data-offline-disabled",h()?"false":"true"),k.tagName==="BUTTON"?h()?k.classList.remove("disabled"):k.classList.add("disabled"):h()?k.removeAttribute("disabled"):k.setAttribute("disabled","true")})},r=()=>{m=!1,i(),g(!0),y()},f=()=>{m=!0,c(),d(),y()},h=()=>m;return{init:()=>{window.addEventListener("online",f),window.addEventListener("offline",r),o=document.getElementById("offline-mode"),o.innerHTML=`
        <div class="d-flex justify-content-center mx-auto">
            <div class="d-flex justify-content-center align-items-center rounded-pill my-2 bg-danger shadow">
                <small class="text-center py-1 px-2 mx-1 mt-1 mb-0 text-white" style="font-size: 0.8rem;"></small>
            </div>
        </div>`},isOnline:h}})();var P=(()=>{let o=null,m=null,g=null,d=null,i=null,c=null,l=250,y=()=>`
        <div class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4">
            <div class="d-flex flex-wrap justify-content-between align-items-center placeholder-wave">
                <span class="placeholder bg-secondary col-5 rounded-3 my-1"></span>
                <span class="placeholder bg-secondary col-3 rounded-3 my-1"></span>
            </div>
            <hr class="my-1">
            <p class="placeholder-wave m-0">
                <span class="placeholder bg-secondary col-6 rounded-3"></span>
                <span class="placeholder bg-secondary col-5 rounded-3"></span>
                <span class="placeholder bg-secondary col-12 rounded-3 my-1"></span>
            </p>
        </div>`,r=e=>([["*",'<strong class="text-theme-auto">$1</strong>'],["_",'<em class="text-theme-auto">$1</em>'],["~",'<del class="text-theme-auto">$1</del>'],["```",'<code class="font-monospace text-theme-auto">$1</code>']].forEach(b=>{let E=b[0],R=b[1];e=e.replace(new RegExp(`\\${E}(?=\\S)(.*?)(?<!\\s)\\${E}`,"gs"),R)}),e),f=e=>`
        <button style="font-size: 0.8rem;" onclick="undangan.comment.like.like(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto ms-auto rounded-3 p-0 shadow-sm d-flex justify-content-start align-items-center" data-offline-disabled="false">
            <span class="my-0 mx-1" data-count-like="${e.like.love}">${e.like.love}</span>
            <i class="me-1 ${g.has(e.uuid)?"fa-solid fa-heart text-danger":"fa-regular fa-heart"}"></i>
        </button>`,h=e=>{let a=`<div class="d-flex flex-wrap justify-content-start align-items-center" data-button-action="${e.uuid}">`;return(d.get("can_reply")==!0||d.get("can_reply")===void 0)&&(a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.reply(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Reply</button>`),m.has(e.uuid)&&(d.get("can_edit")==!0||d.get("can_edit")===void 0)&&(a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.edit(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Edit</button>`),x.isAdmin()?a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-own="${e.own}" data-offline-disabled="false">Delete</button>`:m.has(e.uuid)&&(d.get("can_delete")==!0||d.get("can_delete")===void 0)&&(a+=`<button style="font-size: 0.8rem;" onclick="undangan.comment.remove(this)" data-uuid="${e.uuid}" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1 shadow-sm" data-offline-disabled="false">Delete</button>`),a+="</div>",a},B=(e,a)=>{let b=c.get("show").includes(e);return`<a class="text-theme-auto" style="font-size: 0.8rem;" onclick="undangan.comment.showOrHide(this)" data-uuid="${e}" data-uuids="${a.join(",")}" data-show="${b?"true":"false"}" role="button" class="me-auto ms-1 py-0">${b?"Hide replies":`Show replies (${a.length})`}</a>`},u=e=>`
        <div class="d-flex flex-wrap justify-content-between align-items-center" id="button-${e.uuid}">
            ${h(e)}
            ${e.comments.length>0?B(e.uuid,e.comments.map(a=>a.uuid)):""}
            ${f(e)}
        </div>`,k=e=>e.ip===void 0||e.user_agent===void 0||e.is_admin?"":`
        <div class="mb-1 mt-3">
            <p class="text-theme-auto mb-1 mx-0 mt-0 p-0" style="font-size: 0.7rem;" id="ip-${e.uuid}"><i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(e.ip)} ${i.has(e.ip)?`<strong>${i.get(e.ip)}</strong>`:'<span class="mb-1 placeholder col-2 rounded-3"></span>'}</p>
            <p class="text-theme-auto m-0 p-0" style="font-size: 0.7rem;"><i class="fa-solid fa-mobile-screen-button me-1"></i>${T.parseUserAgent(T.escapeHtml(e.user_agent))}</p>
        </div>`,n=(e,a)=>a?'class="bg-theme-auto shadow p-3 mx-0 mt-0 mb-3 rounded-4" data-parent="true"':`class="${c.get("hidden").find(b=>b.uuid===e.uuid).show?"":"d-none"} overflow-x-scroll mw-100 border-start bg-theme-auto py-2 ps-2 pe-0 my-2 ms-2 me-0"`,p=(e,a)=>e.is_admin?`<strong class="me-1">${T.escapeHtml(o.get("name")??d.get("name"))}</strong><i class="fa-solid fa-certificate text-primary"></i>`:a?`<strong class="me-1">${T.escapeHtml(e.name)}</strong><i id="badge-${e.uuid}" class="fa-solid ${e.presence?"fa-circle-check text-success":"fa-circle-xmark text-danger"}"></i>`:`<strong>${T.escapeHtml(e.name)}</strong>`,v=(e,a)=>{let b=r(T.escapeHtml(e.comment)),E=b.length>l;return`
        <div class="d-flex flex-wrap justify-content-between align-items-center">
            <p class="text-theme-auto text-truncate m-0 p-0" style="font-size: 0.95rem;">${p(e,a)}</p>
            <small class="text-theme-auto m-0 p-0" style="font-size: 0.75rem;">${e.created_at}</small>
        </div>
        <hr class="my-1">
        <p class="text-theme-auto my-1 mx-0 p-0" style="white-space: pre-wrap !important; font-size: 0.95rem;" ${E?`data-comment="${T.base64Encode(b)}"`:""} id="content-${e.uuid}">${E?b.slice(0,l)+"...":b}</p>
        ${E?`<p class="mb-2 mt-0 mx-0 p-0"><a class="text-theme-auto" role="button" style="font-size: 0.85rem; display: block;" data-show="false" onclick="undangan.comment.showMore(this, '${e.uuid}')">Selengkapnya</a></p>`:""}`},$=(e,a)=>`
        <div ${n(e,a)} id="${e.uuid}" style="overflow-wrap: break-word !important;">
            <div id="body-content-${e.uuid}" data-tapTime="0" data-liked="false" tabindex="0">
            ${v(e,a)}
            </div>
            ${k(e)}
            ${u(e)}
            <div id="reply-content-${e.uuid}">${e.comments.map(b=>H(b)).join("")}</div>
        </div>`,H=e=>$(e,!1);return{init:()=>{o=L("user"),m=L("owns"),g=L("likes"),d=L("config"),i=L("tracker"),c=L("comment")},renderEdit:(e,a)=>{let b=document.createElement("div");return b.classList.add("my-2"),b.id=`inner-${e}`,b.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-pen me-2"></i>Edit</label>
        ${document.getElementById(e).getAttribute("data-parent")==="true"&&!x.isAdmin()?`
        <select class="form-select shadow-sm mb-2 rounded-4" id="form-inner-presence-${e}" data-offline-disabled="false">
            <option value="1" ${a?"selected":""}>Datang</option>
            <option value="2" ${a?"":"selected"}>Berhalangan</option>
        </select>`:""}
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type update comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.update(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Update</button>
        </div>`,b},renderReply:e=>{let a=document.createElement("div");return a.classList.add("my-2"),a.id=`inner-${e}`,a.innerHTML=`
        <label for="form-inner-${e}" class="form-label my-1" style="font-size: 0.95rem;"><i class="fa-solid fa-reply me-2"></i>Reply</label>
        <textarea class="form-control shadow-sm rounded-4 mb-2" id="form-inner-${e}" minlength="1" maxlength="1000" placeholder="Type reply comment" rows="3" data-offline-disabled="false"></textarea>
        <div class="d-flex flex-wrap justify-content-end align-items-center mb-0">
            <button style="font-size: 0.8rem;" onclick="undangan.comment.cancel('${e}')" class="btn btn-sm btn-outline-auto rounded-4 py-0 me-1" data-offline-disabled="false">Cancel</button>
            <button style="font-size: 0.8rem;" onclick="undangan.comment.send(this)" data-uuid="${e}" class="btn btn-sm btn-outline-auto rounded-4 py-0" data-offline-disabled="false">Send</button>
        </div>`,a},renderLoading:y,renderReadMore:B,renderInnerContent:H,renderContent:e=>$(e,!0),convertMarkdownToHTML:r,maxCommentLength:l}})();var ee=()=>window.confetti.shapeFromPath({path:"M167 72c19,-38 37,-56 75,-56 42,0 76,33 76,75 0,76 -76,151 -151,227 -76,-76 -151,-151 -151,-227 0,-42 33,-75 75,-75 38,0 57,18 76,56z",matrix:[.03333333333333333,0,0,.03333333333333333,-5.566666666666666,-5.533333333333333]});var Y=o=>{if(!window.confetti)return;let m=Date.now()+25,g=Math.max(.3,Math.min(1,o.getBoundingClientRect().top/window.innerHeight+.2)),d=ee(),i=["#FF69B4","#FF1493"];(function c(){i.forEach(l=>{window.confetti({particleCount:2,angle:60,spread:55,shapes:[d],origin:{x:0,y:g},zIndex:1057,colors:[l]}),window.confetti({particleCount:2,angle:120,spread:55,shapes:[d],origin:{x:1,y:g},zIndex:1057,colors:[l]})}),Date.now()<m&&requestAnimationFrame(c)})()};var V=(()=>{let o=null,m=async i=>{let c=i.firstElementChild,l=i.lastElementChild,y=i.getAttribute("data-uuid"),r=parseInt(c.getAttribute("data-count-like"));i.disabled=!0,o.has(y)?await A(D,"/api/comment/"+o.get(y)).token(x.getToken()).send(I.statusResponse).then(f=>{f.data.status&&(o.unset(y),l.classList.remove("fa-solid","text-danger"),l.classList.add("fa-regular"),c.setAttribute("data-count-like",String(r-1)))}):await A(U,"/api/comment/"+y).token(x.getToken()).send(I.uuidResponse).then(f=>{f.code==201&&(o.set(y,f.data.uuid),l.classList.remove("fa-regular"),l.classList.add("fa-solid","text-danger"),c.setAttribute("data-count-like",String(r+1)))}),c.innerText=c.getAttribute("data-count-like"),i.disabled=!1};return{init:()=>{o=L("likes")},like:m,tapTap:async i=>{if(!navigator.onLine)return;let c=Date.now(),l=c-parseInt(i.getAttribute("data-tapTime")),y=i.id.replace("body-content-",""),r=l<300&&l>0,f=!o.has(y)&&i.getAttribute("data-liked")!=="true";if(r&&f){navigator.vibrate&&navigator.vibrate(100),Y(i);let h=document.querySelector(`[onclick="undangan.comment.like.like(this)"][data-uuid="${y}"]`);i.setAttribute("data-liked","true"),await m(h),i.setAttribute("data-liked","false")}i.setAttribute("data-tapTime",c)}}})();var _=(()=>{let o=10,m=0,g=0,d=null,i=null,c=null,l=null,y=e=>{o=Number(e)},r=()=>o,f=()=>m,h=()=>g,B=()=>i.classList.contains("disabled")?null:i.classList.add("disabled"),u=()=>i.classList.contains("disabled")?i.classList.remove("disabled"):null,k=()=>c.classList.contains("disabled")?null:c.classList.add("disabled"),n=()=>c.classList.contains("disabled")?c.classList.remove("disabled"):null,p=()=>{l.classList.contains("d-none")&&l.classList.remove("d-none")},v=e=>{e.disabled=!0;let a=e.innerHTML;e.innerHTML='<span class="spinner-border spinner-border-sm my-0 mx-1 p-0" style="height: 0.8rem; width: 0.8rem;"></span>';let b=async()=>{await N.comment(),e.disabled=!1,e.innerHTML=a,N.scroll()};return{next:async()=>{m+=o,e.innerHTML="Next"+e.innerHTML,await b(),d.innerText=String(parseInt(d.innerText)+1)},prev:async()=>{m-=o,e.innerHTML=e.innerHTML+"Prev",await b(),d.innerText=String(parseInt(d.innerText)-1)}}};return{init:()=>{l=document.getElementById("pagination"),l.innerHTML=`
        <ul class="pagination mb-2 shadow-sm rounded-4">
            <li class="page-item disabled" id="previous">
                <button class="page-link rounded-start-4" onclick="undangan.comment.pagination.previous(this)" data-offline-disabled="false">
                    <i class="fa-solid fa-circle-left me-1"></i>Prev
                </button>
            </li>
            <li class="page-item disabled">
                <span class="page-link text-theme-auto" id="page">1</span>
            </li>
            <li class="page-item" id="next">
                <button class="page-link rounded-end-4" onclick="undangan.comment.pagination.next(this)" data-offline-disabled="false">
                    Next<i class="fa-solid fa-circle-right ms-1"></i>
                </button>
            </li>
        </ul>`,d=document.getElementById("page"),i=document.getElementById("previous"),c=document.getElementById("next")},setPer:y,getPer:r,getNext:f,reset:async()=>m===0?!1:(m=0,g=0,d.innerText=1,k(),B(),await N.comment(),!0),setResultData:e=>{if(g=e,m>0&&u(),g<o){k();return}n(),p()},getResultData:h,previous:async e=>{B(),!(m<0)&&(k(),await v(e).prev())},next:async e=>{k(),!(g<o)&&(B(),await v(e).next())}}})();var N=(()=>{let o=null,m=null,g=null,d=null,i=()=>'<div class="text-center p-4 my-2 bg-theme-auto rounded-4 shadow"><p class="fw-bold p-0 m-0" style="font-size: 0.95rem;">Yuk bagikan undangan ini biar banyak komentarnya</p></div>',c=(s,t)=>{document.querySelector(`[data-button-action="${s}"]`).childNodes.forEach(w=>{w.disabled=t})},l=async s=>{if(!confirm("Are you sure?"))return;let t=s.getAttribute("data-uuid");x.isAdmin()&&o.set(t,s.getAttribute("data-own")),c(t,!0);let w=T.disableButton(s),e=document.querySelector(`[onclick="undangan.comment.like.like(this)"][data-uuid="${t}"]`);if(e.disabled=!0,!await A(W,"/api/comment/"+o.get(t)).token(x.getToken()).send(I.statusResponse).then(E=>E.data.status,()=>!1)){w.restore(),e.disabled=!1;return}document.querySelectorAll('a[onclick="undangan.comment.showOrHide(this)"]').forEach(E=>{let R=E.getAttribute("data-uuids").split(",");if(R.find(q=>q===t)){let q=R.filter(S=>S!==t).join(",");q.length===0?E.remove():E.setAttribute("data-uuids",q)}}),o.unset(t),document.getElementById(t).remove();let b=document.getElementById("comments");b.children.length==0&&(b.innerHTML=i())},y=async s=>{let t=s.getAttribute("data-uuid"),w=!1,e=document.getElementById(`form-inner-presence-${t}`);e&&(e.disabled=!0,w=e.value==="1");let a=document.getElementById(`form-${t?`inner-${t}`:"comment"}`),b=!1,E=document.getElementById(`badge-${t}`);if(E&&(b=E.classList.contains("text-success")),t&&T.base64Encode(a.value)===a.getAttribute("data-original")&&b===w){c(t,!1),document.getElementById(`inner-${t}`).remove();return}a.disabled=!0;let R=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);R&&(R.disabled=!0);let q=T.disableButton(s),S=await A(G,"/api/comment/"+o.get(t)).token(x.getToken()).body(I.updateCommentRequest(e?w:null,a.value)).send(I.statusResponse).then(Z=>Z.data.status,()=>!1);if(a.disabled=!1,R&&(R.disabled=!1),e&&(e.disabled=!1),q.restore(),!S)return;c(t,!1),document.getElementById(`inner-${t}`).remove();let C=document.querySelector(`[onclick="undangan.comment.showMore(this, '${t}')"]`),M=P.convertMarkdownToHTML(T.escapeHtml(a.value)),z=document.getElementById(`content-${t}`);if(M.length>P.maxCommentLength?(z.innerHTML=C?.getAttribute("data-show")==="false"?M.slice(0,P.maxCommentLength)+"...":M,z.setAttribute("data-comment",T.base64Encode(M)),C?.style.display==="none"&&(C.style.display="block")):(z.innerHTML=M,z.removeAttribute("data-comment"),C?.style.display==="block"&&(C.style.display="none")),e&&(document.getElementById("form-presence").value=w?"1":"2",L("information").set("presence",w)),!(!e||!E)){if(w){E.classList.remove("fa-circle-xmark","text-danger"),E.classList.add("fa-circle-check","text-success");return}E.classList.remove("fa-circle-check","text-success"),E.classList.add("fa-circle-xmark","text-danger")}},r=async s=>{let t=s.getAttribute("data-uuid"),w=document.getElementById("form-name"),e=w.value;if(x.isAdmin()&&(e=m.get("name")),e.length==0){t&&w.scrollIntoView({behavior:"smooth"}),alert("Silakan masukkan nama Anda.");return}let a=document.getElementById("form-presence");if(!t&&a&&a.value=="0"){alert("Silakan pilih status kehadiran Anda.");return}!t&&w&&!x.isAdmin()&&(w.disabled=!0),a&&a.value!="0"&&(a.disabled=!0);let b=document.getElementById(`form-${t?`inner-${t}`:"comment"}`);b.disabled=!0;let E=document.querySelector(`[onclick="undangan.comment.cancel('${t}')"]`);E&&(E.disabled=!0);let R=T.disableButton(s),q=a?a.value==="1":!0;if(!x.isAdmin()){let C=L("information");C.set("name",e),t||C.set("presence",q)}let S=await A(U,"/api/comment").token(x.getToken()).body(I.postCommentRequest(t,e,q,b.value)).send(I.getCommentResponse).then(C=>C,()=>null);if(w&&(w.disabled=!1),b.disabled=!1,E&&(E.disabled=!1),a&&(a.disabled=!1),R.restore(),!(!S||S.code!==201)){if(o.set(S.data.uuid,S.data.own),b.value=null,!t){if(await _.reset()){$();return}S.data.is_admin=x.isAdmin();let M=document.getElementById("comments");_.setResultData(M.children.length),_.getResultData()==_.getPer()&&M.lastElementChild.remove(),M.innerHTML=P.renderContent(S.data)+M.innerHTML,$()}if(t){d.set("hidden",d.get("hidden").concat([I.commentShowMore(S.data.uuid,!0)])),d.set("show",d.get("show").concat([t])),c(t,!1),document.getElementById(`inner-${t}`).remove(),S.data.is_admin=x.isAdmin(),document.getElementById(`reply-content-${t}`).insertAdjacentHTML("beforeend",P.renderInnerContent(S.data));let C=document.getElementById(`button-${t}`),M=C.querySelector("a"),z=[S.data.uuid];M&&(M.getAttribute("data-show")==="false"&&k(M),M.remove()),C.querySelector(`button[onclick="undangan.comment.like.like(this)"][data-uuid="${t}"]`).insertAdjacentHTML("beforebegin",P.renderReadMore(t,M?M.getAttribute("data-uuids").split(",").concat(z):z))}p(S.data)}},f=s=>{let t=document.getElementById(`form-inner-${s}`),w=!1,e=document.getElementById(`form-inner-presence-${s}`);e&&(w=e.value==="1");let a=!1,b=document.getElementById(`badge-${s}`);b&&(a=b.classList.contains("text-success")),(t.value.length===0||T.base64Encode(t.value)===t.getAttribute("data-original")&&a===w||confirm("Are you sure?"))&&(c(s,!1),document.getElementById(`inner-${s}`).remove())},h=s=>{let t=s.getAttribute("data-uuid");document.getElementById(`inner-${t}`)||(c(t,!0),document.getElementById(`button-${t}`).insertAdjacentElement("afterend",P.renderReply(t)))},B=async s=>{let t=s.getAttribute("data-uuid");if(document.getElementById(`inner-${t}`))return;c(t,!0);let w=T.disableButton(s);await A(O,"/api/comment/"+t).token(x.getToken()).send(I.commentResponse).then(e=>{if(e.code!==200)return;document.getElementById(`button-${t}`).insertAdjacentElement("afterend",P.renderEdit(t,e.data.presence));let a=document.getElementById(`form-inner-${t}`);a.value=e.data.comment,a.setAttribute("data-original",T.base64Encode(e.data.comment))}),w.restore(),s.disabled=!0},u=()=>{let s=document.getElementById("comments");return s.getAttribute("data-loading")==="false"&&(s.setAttribute("data-loading","true"),s.innerHTML=P.renderLoading().repeat(_.getPer())),A(O,`/api/comment?per=${_.getPer()}&next=${_.getNext()}`).token(x.getToken()).send(I.getCommentsResponse).then(t=>{if(_.setResultData(t.data.length),s.setAttribute("data-loading","false"),t.data.length===0)return s.innerHTML=i(),t;let w=(e,a)=>(e.forEach(b=>{a.find(E=>E.uuid===b.uuid)||a.push(I.commentShowMore(b.uuid)),b.comments&&b.comments.length>0&&w(b.comments,a)}),a);return d.set("hidden",w(t.data,d.get("hidden"))),s.innerHTML=t.data.map(e=>P.renderContent(e)).join(""),t.data.forEach(v),t.data.forEach(p),t})},k=s=>{let t=s.getAttribute("data-uuids").split(","),w=s.getAttribute("data-show")==="true",e=s.getAttribute("data-uuid");w?(s.setAttribute("data-show","false"),s.innerText="Show replies",s.innerText+=" ("+t.length+")",d.set("show",d.get("show").filter(a=>a!==e))):(s.setAttribute("data-show","true"),s.innerText="Hide replies",d.set("show",d.get("show").concat([e])));for(let a of t){d.set("hidden",d.get("hidden").map(E=>(E.uuid===a&&(E.show=!w),E)));let b=document.getElementById(a).classList;w?b.add("d-none"):b.remove("d-none")}},n=(s,t)=>{let w=document.getElementById(`content-${t}`),e=T.base64Decode(w.getAttribute("data-comment")),a=s.getAttribute("data-show")==="false";w.innerHTML=a?e:e.slice(0,P.maxCommentLength)+"...",s.innerText=a?"Sebagian":"Selengkapnya",s.setAttribute("data-show",a?"true":"false")},p=s=>{s.comments&&s.comments.forEach(p);let t=document.getElementById(`body-content-${s.uuid}`);t.addEventListener("touchend",()=>V.tapTap(t))},v=s=>{x.isAdmin()&&(s.comments&&s.comments.forEach(v),!(s.ip===void 0||s.user_agent===void 0||s.is_admin||g.has(s.ip))&&fetch(`https://freeipapi.com/api/json/${s.ip}`).then(t=>t.json()).then(t=>{let w=t.cityName+" - "+t.regionName;t.cityName=="-"&&t.regionName=="-"&&(w="localhost"),g.set(s.ip,w),document.getElementById(`ip-${s.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(s.ip)} <strong>${w}</strong>`}).catch(t=>{document.getElementById(`ip-${s.uuid}`).innerHTML=`<i class="fa-solid fa-location-dot me-1"></i>${T.escapeHtml(s.ip)} <strong>${T.escapeHtml(t.message)}</strong>`}))},$=()=>document.getElementById("comments").scrollIntoView({behavior:"smooth"});return{like:V,pagination:_,init:()=>{V.init(),P.init(),_.init(),o=L("owns"),m=L("user"),g=L("tracker"),d=L("comment"),d.has("hidden")||d.set("hidden",[]),d.has("show")||d.set("show",[])},scroll:$,cancel:f,send:r,edit:B,reply:h,remove:l,update:y,comment:u,showMore:n,showOrHide:k}})();var Q=(()=>{let o=async()=>{await j.getDetailUser().then(n=>{document.getElementById("dashboard-name").innerHTML=`${T.escapeHtml(n.data.name)}<i class="fa-solid fa-hands text-warning ms-2"></i>`,document.getElementById("dashboard-email").innerHTML=n.data.email,document.getElementById("dashboard-accesskey").value=n.data.access_key,document.getElementById("button-copy-accesskey").setAttribute("data-copy",n.data.access_key),document.getElementById("form-name").value=T.escapeHtml(n.data.name),document.getElementById("filterBadWord").checked=!!n.data.is_filter,document.getElementById("replyComment").checked=!!n.data.can_reply,document.getElementById("editComment").checked=!!n.data.can_edit,document.getElementById("deleteComment").checked=!!n.data.can_delete}),A(O,"/api/stats").token(x.getToken()).send().then(n=>{document.getElementById("count-comment").innerHTML=String(n.data.comments).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-like").innerHTML=String(n.data.likes).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-present").innerHTML=String(n.data.present).replace(/\B(?=(\d{3})+(?!\d))/g,"."),document.getElementById("count-absent").innerHTML=String(n.data.absent).replace(/\B(?=(\d{3})+(?!\d))/g,".")}),N.comment()},m=async n=>{let p=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({filter:!!n.checked}).send(),p.restore()},g=async n=>{let p=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({can_reply:!!n.checked}).send(),p.restore()},d=async n=>{let p=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({can_edit:!!n.checked}).send(),p.restore()},i=async n=>{let p=T.disableCheckbox(n);await A(D,"/api/user").token(x.getToken()).body({can_delete:!!n.checked}).send(),p.restore()},c=async n=>{if(!confirm("Are you sure?"))return;let p=T.disableButton(n);await A(G,"/api/key").token(x.getToken()).send(I.statusResponse).then(v=>{v.data.status&&o()}),p.restore()},l=async n=>{let p=document.getElementById("old_password"),v=document.getElementById("new_password");if(p.value.length==0||v.value.length==0){alert("Password cannot be empty");return}p.disabled=!0,v.disabled=!0;let $=T.disableButton(n),H=await A(D,"/api/user").token(x.getToken()).body({old_password:p.value,new_password:v.value}).send(I.statusResponse).then(s=>s.data.status,()=>!1);$.restore(),p.disabled=!1,v.disabled=!1,H&&(p.value=null,v.value=null,n.disabled=!0,alert("Success change password"))},y=async n=>{let p=document.getElementById("form-name");if(p.value.length==0){alert("Name cannot be empty");return}p.disabled=!0;let v=T.disableButton(n),$=await A(D,"/api/user").token(x.getToken()).body({name:p.value}).send(I.statusResponse).then(H=>H.data.status,()=>!1);p.disabled=!1,v.restore(),$&&(o(),n.disabled=!0,alert("Success change name"))},r=async n=>{let p=T.disableButton(n);await A(O,"/api/download").token(x.getToken()).download(),p.restore()},f=()=>{let n=document.getElementById("button-change-name");n.disabled&&(n.disabled=!1)},h=()=>{let n=document.getElementById("button-change-password"),p=document.getElementById("old_password");n.disabled&&p.value.length!==0&&(n.disabled=!1)},B=()=>{confirm("Are you sure?")&&j.clearSession()},u=()=>{X.init(),x.isAdmin()||(L("owns").clear(),L("likes").clear(),L("config").clear(),L("comment").clear(),L("session").clear(),L("information").clear()),J.spyTop(),N.init(),document.addEventListener("hidden.bs.modal",o);try{let n=x.decode()?.exp;if(!n||n<Date.now()/1e3)throw new Error("Invalid token");o()}catch{j.clearSession()}};return{init:()=>(j.init(),J.init(),x.init(),window.addEventListener("DOMContentLoaded",u),{util:T,theme:J,comment:N,admin:{auth:j,navbar:K,logout:B,download:r,regenerate:c,editComment:d,replyComment:g,deleteComment:i,changeName:y,changePassword:l,changeFilterBadWord:m,enableButtonName:f,enableButtonPassword:h}})}})();(o=>{o.undangan=Q.init()})(window);})();
